<!DOCTYPE html>
<html>

<head>
    <title>地图API－范例－行政区划查询</title>
    <meta charset="UTF-8" />
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta tabindex="">
    <link rel="stylesheet" type="text/css" href="http://demo.ishowchina.com/apidemos/sourceLinks/style.css" />
    <script type="text/javascript" src="http://api.ishowchina.com/v4/webapi/js/auth?v=3.6.3&t=jsmap&ak=ec85d3648154874552835438ac6a02b2"></script>
    <script src="http://public.ishowchina.com/js/jquery-1.11.3.min.js"></script>
    <style type="text/css">
    .contro_panel_position_ll {
        left: 20px;
        top: 20px;
    }
    </style>
</head>

<body>
    <div id="map" class="map_contaner"></div>
    <div id="pannel" class="contro_panel contro_panel_position_ll contro_panel_height" style="width:200px;height:50px;overflow-y: inherit;">
        &nbsp;&nbsp;行政区划搜索：
        <div style="margin-left: 12px;margin-top: 4px;">
            <input id="keyword" type="text" class="text">
            <div id="suggestId" style="position: fixed;background-color: #ffffff;border: 1px solid #d1d1d1;visibility: visible; min-width: 151px; display: none;"></div>
        </div>
    </div>
    <script type="text/javascript">
    var map;

    function initMap() {
        map = new IMAP.Map("map", {
            minZoom: 4, //最小地图级别
            maxZoom: 18, //最大地图级别
            zoom: 12, //初始化级别
            center: new IMAP.LngLat(116.40976, 39.90131) //中心点坐标
        });
        //boundary('北京市');
        $('#keyword').change(function() {
            boundary($(this).val());
        })

    }

    function boundary(keyword) {
        var overlays = [];
        if (map) {
            var keyword = keyword;
            map.plugin(['IMAP.DistrictSearch'], function() {
                boundarySearch = new IMAP.DistrictSearch();
                boundarySearch.search(keyword,
                    function(status, result) {
                        if (status == 0) {
                            var paths = result.results,
                                pathArray;
                            //把paths[i].polyline这个存储
                            for (var i = 0, l = paths.length; i < l; ++i) {
                                if (paths[i]) {
                                    pathArray = paths[i].polyline.split("|");
                                    var path;

                                    for (var j = 0, jl = pathArray.length; j < jl; ++j) {
                                        var lnglats = [];
                                        path = pathArray[j].split(";");
                                        for (var n = 0, nl = path.length; n < nl; ++n) {
                                            var lnglat = path[n].split(",");
                                            lnglat = new IMAP.LngLat(lnglat[0], lnglat[1]);
                                            lnglats.push(lnglat);
                                        }
                                        //console.log(lnglats)
                                        var polygon = new IMAP.Polygon(lnglats, {
                                            fillOpacity: 0.5,
                                            strokeStyle: IMAP.Constants.OVERLAY_LINE_DASHED,
                                            strokeWeight: 2
                                        });
                                        overlays.push(polygon);
                                    }

                                }
                            }
                            var bound = paths[0];
                            if (!bound) {
                                return;
                            }
                            var title = keyword;
                            var level = getLevelStr(bound.level);
                            var content = '<div style="padding:0px 0px 0px 4px;">名称：' + bound.name + '<br>行政区划级别：' + level + '<br> 区号：' + bound.citycode + '<br>行政区编码：' + bound.adcode + '</div>';
                            infowindow = new IMAP.InfoWindow(content, {
                                size: new IMAP.Size(300, 200),
                                title: title,
                                position: bound.center,
                                // autoPan : true,
                                type: IMAP.Constants.OVERLAY_INFOWINDOW_DEFAULT
                            });
                            overlays.push(infowindow);
                            map.getOverlayLayer().clear();
                            map.getOverlayLayer().addOverlays(overlays, true);
                        }
                    });
            });
        }
    }

    function getLevelStr(level) {
        var result = "";
        switch (level) {
            case "province":
                result = "省";
                break;
            case "city":
                result = "城市";
                break;
            case "district":
                result = "区、县";
                break;
        }

        return result;
    }
    //清空结果
    function clearReaults() {
        if (map) {
            map.getOverlayLayer().clear();
        }
    }
    initMap();
    </script>
</body>

</html>