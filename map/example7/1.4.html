<!DOCTYPE html>
<html>
<head>
	<title>地图API－范例－输入提示</title>
	<meta charset="UTF-8" />
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta tabindex="">
	<link rel="stylesheet" type="text/css" href="http://demo.ishowchina.com/apidemos/sourceLinks/style.css" />
	<script type="text/javascript" src="http://api.ishowchina.com/v4/webapi/js/auth?v=3.6.3&t=jsmap&ak=ec85d3648154874552835438ac6a02b2"></script>
	
</head>
<body>
	<div id="map"  class="map_contaner"></div>
	<div id="pannel" class="contro_panel contro_panel_position_lr contro_panel_height" style="width:200px;height:50px;overflow-y: inherit;">
		&nbsp;&nbsp;请输入关键字：
		<div style="margin-left: 12px;margin-top: 4px;">
			<input id="keyword" type="text" class="text" onkeyup="doSuggest(this)">
			<div id="suggestId" style="position: fixed;background-color: #ffffff;border: 1px solid #d1d1d1;visibility: visible; min-width: 151px; display: none;"></div>
		</div>
	</div>
	<script type="text/javascript">
		var map, suggest, poiSearch, markers=[];
		function initMap(){
			map=new IMAP.Map("map", {
				minZoom:4,//最小地图级别
				maxZoom:18,//最大地图级别
				zoom:12,//初始化级别
				center:new IMAP.LngLat(116.40976,39.90131)//中心点坐标
			});
		}
		//POI联想词搜索
		function doSuggest(obj){
			var keyword=document.getElementById("keyword").value,suggestId=document.getElementById("suggestId"),city='北京市';
			while(suggestId.hasChildNodes()){
				suggestId.removeChild(suggestId.firstChild);
			}
			if(!keyword){
				return;
			}
			map.plugin(['IMAP.Suggest'], function(){
				suggest=new IMAP.Suggest();
				suggest.search(keyword,city,function(status,results) {
					if (status==0) {
						var records = results.results,record, li;
						suggestId.style.display = "block";
						var ul = document.createElement("ul");
						ul.style.backgroundColor = "rgb(181, 53, 53)";
						for (var i = 0, l = records.length; i < l; ++i) {
							record = records[i];
							li = document.createElement("li");
							li.innerHTML = record.name;
							addSuggestEvt(record.name, li);
							ul.appendChild(li);
						}
						suggestId.appendChild(ul);
					}
				});
			});

		}
		function addSuggestEvt(name,obj){
			obj.onclick=function(){
				var suggestId=document.getElementById("suggestId");
				while(suggestId.hasChildNodes()){
					suggestId.removeChild(suggestId.firstChild);
				}
				suggestId.style.display="none";
				document.getElementById("keyword").value=name;
				doSearch(1);
			}
			obj.onmouseover=function(){
				obj.style.backgroundColor="#cacaca";
			};
			obj.onmouseout=function(){
				obj.style.backgroundColor="rgb(181, 53, 53)";
			};
		}
		//POI搜索
		function doSearch(pageNo){
			if(map){
				clearReaults();
				var keyword=document.getElementById("keyword").value,city='北京市';
				if(!keyword){
					return;
				}
				var icons={
					"0":{size:{"width":33,"height":30},offset:{x:-34,y:0}},
					"1":{size:{"width":33,"height":30},offset:{x:-68,y:0}},
					"2":{size:{"width":33,"height":30},offset:{x:-102,y:0}},
					"3":{size:{"width":33,"height":30},offset:{x:-136,y:0}},
					"4":{size:{"width":33,"height":30},offset:{x:-170,y:0}},
					"5":{size:{"width":33,"height":30},offset:{x:-204,y:0}},
					"6":{size:{"width":33,"height":30},offset:{x:-238,y:0}},
					"7":{size:{"width":33,"height":30},offset:{x:-272,y:0}},
					"8":{size:{"width":33,"height":30},offset:{x:-306,y:0}},
					"9":{size:{"width":33,"height":30},offset:{x:-340,y:0}}
				};
				var toFunc=function(markers){
					poiSearch.setPageNumber(parseInt(pageNo-1));
					poiSearch.search(keyword,city,function(status,result){
						if(status==0){
							var datas=result.results,marker,data,content;
							var iconUrl=IMAP.MapConfig.API_REALM_NAME+IMAP.MapConfig._MAP_POINT_URL;
							var icon;
							for(var i=0,l=datas.length;i<l;++i){
								data=datas[i];
								icon=icons[i];
								if(!icon){
									icon=icons[0];
								}
								marker=new IMAP.Marker(new IMAP.LngLat(data.location.lng,data.location.lat),{icon:new IMAP.Icon(iconUrl,icon.size,icon.offset)});
								marker._data=data;
								addEvent(marker);
								markers.push(marker);
							}
							map.getOverlayLayer().addOverlays(markers,true);
						}
					});
				}
				map.plugin(['IMAP.PoiSearch'], function(){
					poiSearch=new IMAP.PoiSearch({pageSize: 5});
					toFunc(markers);
				});
			}
		}
		//添加点事件
		function addEvent(m){
			m.addEventListener(IMAP.Constants.CLICK,function(cObj){
				displayInfoWindow(m,m._data);
			},m);
		}
		//显示信息框
		function displayInfoWindow(m,data){
			var content = "<div style=\"font-family:\"微软雅黑\",Arial, Helvetica, sans-serif;font-size:12px;\">地址："+data.address;
			if(data.telephone){
				content+=("<br />电话："+data.telephone);
			}
			content+="</div></div>";
			m.openInfoWindow(content,{
				title:data.name,
				offset:new IMAP.Pixel(-5,-30),
				size:new IMAP.Size(250,100)
			});
		}
		//清空
		function clearReaults(){
			map.getOverlayLayer().clear(markers);
			markers=[];
		}
		initMap();
	</script>
</body>
</html>