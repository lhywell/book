<!DOCTYPE html>
<html>

<head>
    <title>地图API－范例－自定义图层</title>
    <meta charset="UTF-8" />
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta tabindex="">
    <link rel="stylesheet" type="text/css" href="http://demo.ishowchina.com/apidemos/sourceLinks/style.css" />
    <script type="text/javascript" src="http://api.ishowchina.com/v4/webapi/js/auth?v=3.6.3&t=jsmap&ak=ec85d3648154874552835438ac6a02b2"></script>
</head>

<body>
    <div id="map" class="map_contaner"></div>
    <div id="pannel" class="contro_panel_button contro_panel_button_br">
        <input type="button" class="button" value="叠加自定义图层" onclick="addCustomLayer()">&nbsp;
        <input type="button" class="button" value="移除自定义图层" onclick="removeCustomLayer()">
    </div>
    <script type="text/javascript">
    var map, bgTileLayer;

    function initMap() {
        map = new IMAP.Map("map", {
            minZoom: 4, //最小地图级别
            maxZoom: 18, //最大地图级别
            zoom: 12, //初始化级别
            center: new IMAP.LngLat(116.40976, 39.90131) //中心点坐标
        });
        removeCustomLayer();
    }
    //叠加自定义图层
    function addCustomLayer() {
        var id = map.getBGLayerIds()[0];
        if (bgTileLayer) { return; }
        bgTileLayer = new IMAP.TileLayer({
            maxZoom: 18,
            minZoom: 1,
            tileSize: 256
        });
        bgTileLayer.setTileUrlFunc(getTileUrl);
        bgTileLayer.setOpacity(0.2); //设置图层透明度，取值范围0-1
        map.addLayer(bgTileLayer);
    }
    //移除自定义图层
    function removeCustomLayer() {
        if (!bgTileLayer) { return; }
        map.removeLayer(bgTileLayer);
        bgTileLayer = null;
    }
    //取图回调函数
    function getTileUrl(x, y, z) {
        console.log(x)
        //var url = 'http://mt1.google.cn/vt/lyrs=m@180000000&hl=zh-CN&gl=cn&src=app&s=Gal&';//说明：{x},{y},{z}在URL参数中的写法是固定格式
        //url = url.replace('{x}', x).replace('{y}', y).replace('{z}', z);
        var url = "http://imgsrc.baidu.com/baike/pic/item/a54e55fbe70d6945024f5626.jpg";
        return url;
    }
    initMap();
    </script>
</body>

</html>